<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style>
            html, body { height: 100%; margin: 0; }
        </style>
        <link rel="stylesheet" href="css/forceLayout.css">
        <link rel="stylesheet" href="css/tipsy.css">
    </head>
    <body>    
        <script src="js/d3.min.js"></script>
        <script src="js/jquery.min.js"></script>
        <script src="js/q.js"></script>
        <script src="js/lodash.js"></script>
        <script src="js/backbone.js"></script>
        <script src="js/async.js"></script>
        <script src="js/klay.js"></script>
        <script src="js/forceLayout.js"></script>
        <script src="js/jquery.tipsy.js"></script>
        <script>
            (function () {
                'use strict';
                Q.longStackSupport = true;
                var debug = false;
                var layout, createLayout;
                var scxml = '<scxml xmlns="http://www.w3.org/2005/07/scxml" xmlns:cs="http://commons.apache.org/scxml" xmlns:cpqd="http://components.cpqd.com.br/ACTIONS" version="1.0" datamodel="jexl" initial="init"> <state id="init"> <onentry> <cpqd:next-state id="CALL" event="event.call" label="Chamar Ação" manual="true" /> </onentry> <transition event="event.call" target="CALL" /> <onexit><cpqd:log-state label="Log de saida do estado" /></onexit> </state> <state id="CALL"> <onentry> <cpqd:log-state label="Chamando Ação" /> <cpqd:next-state id="WAITING_INPUT" event="event.input" label="Aguardando informação" display="false" /> </onentry> <transition target="WAITING_INPUT" /> </state> <state id="WAITING_INPUT"> <onentry> <cpqd:log-state label="Aguardando preenchimento de informações" needUserInput="true" /> <cpqd:next-state id="EXECUTE" event="event.execute" label="Executar" display="false"/> <cpqd:next-state id="CANCEL" event="event.cancel" label="Cancelar" display="false"/> <cpqd:task name="webinfo" /> </onentry> <transition event="event.execute" target="EXECUTE" /> <transition event="event.cancel" target="CANCEL" /> </state> <state id="EXECUTE"> <onentry> <cpqd:log-state label="Executando ação" /> <cpqd:next-state id="EXECUTION_SUCCESS" event="event.success" label="Executado com sucess" display="false" /> <cpqd:next-state id="EXECUTION_FAILURE" event="event.failure" label="Não executado com sucesso" display="false" /> <cpqd:task name="web-service-bloqueio-recarga" /> </onentry> <transition event="event.success" target="VERIFYING_SITUATION" /> <transition event="event.failure" target="EXECUTION_FAILURE" /> </state> <state id="VERIFYING_SITUATION"> <onentry> <cpqd:log-state label="Verificando situação" /> <cpqd:next-state id="SITUATION_TRUE" event="event.true" label="Situação verificada com sucesso" display="false" /> <cpqd:next-state id="SITUATION_FALSE" event="event.false" label="Situação verificada com erro" display="false" /> <cpqd:task name="regra-verifica-bloqueio-recarga" /> </onentry> <transition event="event.true" target="EXECUTION_SUCCESS" /> <transition event="event.call" target="CALL" cond="teste == 1" /> <transition event="event.false" target="EXECUTION_FAILURE" /> </state> <final id="CANCEL"> <onentry> <cpqd:log-state label="Ação cancelada"/> </onentry> </final> <final id="EXECUTION_SUCCESS"> <onentry> <cpqd:log-state label="Executado com sucesso" /> </onentry> </final> <final id="EXECUTION_FAILURE"> <onentry> <cpqd:log-state label="Não executado com sucesso" /> </onentry> </final> </scxml>';
                var currentState = 'CANCEL';
                ready();

                function invokeLayout(options) {
                    createLayout = function () {
                        layout = new forceLayout.Layout(_.extend({
                            debug: debug
                        }, options));
                        layout.initialized
                                .catch(function (err) {
                                    console.log(err);
                                    console.log(err.stack);
                                    $(layout.el).replaceWith("Error: " + err.message);
                                })
                                .done();
                        window.layout = layout;
                    }
                    createLayout();
                }


                function ready() {
                    var parent = $('<div style="width:100%;height:100%;">')[0];
                    $('body').append(parent);
                    invokeLayout({parent: parent, doc: parse(), currentState: currentState});

                    function parse() {
                        var parser = new window.DOMParser();
                        return parser.parseFromString(scxml, 'text/xml');
                    }
                    

                    var css;
                    $.get('forceLayout.css', function (resp) {
                        css = resp;
                    });

                    function fit() {
                        layout.fit();
                    }
                    

                    fit();
                }
            })();
        </script>
    </body>
</html>
