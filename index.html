<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <style>
            html, body { height: 100%; margin: 0; }
        </style>
        <link rel="stylesheet" href="css/forceLayout.css">
        <link rel="stylesheet" href="css/tipsy.css">
    </head>
    <body>    
        <script src="js/d3.min.js"></script>
        <script src="js/jquery.min.js"></script>
        <script src="js/q.js"></script>
        <script src="js/lodash.js"></script>
        <script src="js/backbone.js"></script>
        <script src="js/async.js"></script>
        <script src="js/klay.js"></script>
        <script src="js/forceLayout.js"></script>
        <script src="js/jquery.tipsy.js"></script>
        <script>
            (function () {
                'use strict';
                Q.longStackSupport = true;
                var debug = false;
                var layout, createLayout;
                var scxml = '<?xml version="1.0" encoding="UTF-8"?><scxml xmlns="http://www.w3.org/2005/07/scxml"><state id="a"><transition target="b" event="e1"/></state><state id="b"/></scxml>';
                var currentState = 'CANCEL';
                ready();

                function invokeLayout(options) {
                    createLayout = function () {
                        layout = new forceLayout.Layout(_.extend({
                            debug: debug
                        }, options));
                        layout.initialized
                                .catch(function (err) {
                                    console.log(err);
                                    console.log(err.stack);
                                    $(layout.el).replaceWith("Error: " + err.message);
                                })
                                .done();
                        window.layout = layout;
                    }
                    createLayout();
                }


                function ready() {
                    var parent = $('<div style="width:100%;height:100%;">')[0];
                    $('body').append(parent);
                    invokeLayout({parent: parent, doc: parse(), currentState: currentState});

                    function parse() {
                        var parser = new window.DOMParser();
                        return parser.parseFromString(scxml, 'text/xml');
                    }
                    

                    var css;
                    $.get('forceLayout.css', function (resp) {
                        css = resp;
                    });

                    function fit() {
                        layout.fit();
                    }
                    

                    fit();
                }
            })();
        </script>
    </body>
</html>
